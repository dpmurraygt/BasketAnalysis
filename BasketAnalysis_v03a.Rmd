---
title: "Association Rules Mining for RB Data"
author: "Dennis Murray and Alex Deshowitz <br> Southern Methodist University- MSDS 7331 <br> April 23, 2017"
output: 
    html_document:
        keep_md: TRUE
    toc: true
    toc_float: 
      collapsed: false
    toc_depth: 2
        
---
#**Executive Summary**
   In this project we created a series of rules based on different categorical breakdowns of items purchased in conjunction with the Red Bull beverage product.  Overall, we found that baskets including Little Debbie snack cakes and 5-hr Energy to be interesting baskets as measured by confidence.  Additionally, we found that certain product categories tend to occur together, albeit with lower support than we might have wished for.  That being said, in future rules association creation, we might consider bringing in SKU and geolocation data in order to improve the model and create more actionable rules.  In addition to the redbull rules, we tried modeling out the entire dataset for all rules at the brand level.  This approach caused us to run out of available memory in R.  For future solves, we might consider taking random-stratified samples that allow us to maintain the same distributions in the training data.

#**Introduction**

  This project seeks to use a dataset from a major retailer to create association rules for our product, RB.  Creating these associations may better help us determine whether or not to use partnerships or reward programs with our customers.  It may also help us develop customer segmentation models based upon variables such as items purchased, brands in the customer basket, and size of overall order.  Ultimately, knowing these pieces of information about our customers will help us better monetize our product, build brand-awareness, and increase brand acquisition for customers who may not have considered our product otherwise.

#**Business Understanding**

  This dataset was collected as part of normal operations at a major retailer.  The purpose of the collection of this information was multiple-fold.  First, this data was collected to track inventories in the store and manage supply chain interactions.  Additionally, this data was collected so that companies selling the products on the shelf in the retailer could gain better insight into product movements and shifts.  Since this data is already being collected, we can now use this information to create association rules that will allow us to better understand the customers who purchase RB.  By understanding this customer better, we will be able to translate that knowledge into better products for the customer, better placement, enhanced partnerships, and increased gross sales.

ADDRESS VALIDATION METHODS

# **Data Understanding**

###Overview

Our dataset was collected by a major retailer and as RB we are using this data for our analysis.  The dataset consists of 5 attributes.  The total size of our dataset is 10,263,051 records.  However, we do do some filtering in the EDA section of the framework in order to better focus on the objective of the analysis.

The collection of this data occurs on an automated basis via the retailer's point-of-sale system.  At the cash register, scanning of the UPC barcode records the specific item, and the quantity of the item, purchased.  This data is transmitted on a daily basis to a third-party aggregator that compiles transactions from all of the retailer's stores, and makes the data available to the retailer's vendor partners for analysis.  In the case of RB, daily data is comprised of items in the same category.  Once per quarter, the aggregator makes available the complete transactional history that can be used for a complete basket analysis.

The 10.2MM records included in this analysis comprise a limited view of the retailer's business.  In fact, it is just one week of data, for a specific physical store format labeled as "Traditional" that comprises about 20% of the retailer's store count.  The data was aggregated from the SKU (UPC or Item Barcode level) to the Department/Class/Brand level.  While this removed the specficity of working at an item level, working at the item level would have reduced the support for anyone transaction type to a much lower level, with each Department/Class/Brand having possibly dozens to hundreds of UPCs available.  Thus, one part of our exploratory data analysis will be comprised of determining the appropriate level of detail to work from to mine the data rules for our analysis.

It is important to also understand that in the context of the retailer, there could be significant variation in basket contents depending on time of the year and this week may not be representative of all time periods of the year.  A broader time sample would be required to properly gauge the variation throughout the year.

It is suspected that we may uncover several different shopping missions.  Based on prior knowledge, we might expect that Tobacco, and snack food will be purchased alongside the targeted brand, Red Bull.  Other beverage items, like water, are also known to be purchased alongside of Red Bull.

### Data Dictionary

**TransactionID**: The transaction ID represents each unique transaction.  There is one record for every item in                         each transaction.  This is aggregated by the item (i.e- a transaction with 2 cans of Red Bull                         will have 1 record for redbull)

**ClassDesc**: Description of the product's class.  This is a high level category the product bought falls into.
  
**DeptDesc**: This is a subset of class. 
  
**Brand**: Product's brand name as created in the item master.  It is important to realize that the Item Master is human-managed, and thus may not be a perfect representation of the 
  
**Units**: Units sold in the current transaction.

### Load All Packages
```{r load package,  results = ('hide'), message = FALSE, WARNING = FALSE}

packages<- c('plyr','data.table','dplyr','arules','arulesViz','tidyr','ggplot2','magrittr', 'sqldf', 'scales')

sapply(packages, library, character.only = TRUE)

```

### Load Main dataframe
```{r}
BasketData<-read.csv("Data/BasketData.csv")
colnames(BasketData)<-c("TransactionID", "ClassDesc", "DeptDesc", "Brand", "Units")
BasketData$Units<-as.numeric(gsub(",", "", as.character(BasketData$Units)))
```

### **EDA- Initial Integrity Checks**

We always take a series of steps to ensure that our dataset is clean and does not contain errors prior to our initial data exploration.  What follows is that process:

```{r}

summary(BasketData)

```
We notice that the dataset appears to contain negative units.  After some exploration of the data, it was determined that these values should be filtered out.  However, remember, that this is transaction data.  Therefore, we don't want to take only the negative values from the transaction.  Our assumption is that one of these values showing up in a transaction negates the entire transaction.  Therefore, some more complex filtering is necessary. We will do the filtering at the end of this process.

```{r}

str(BasketData)


```
It looks like all of the variables were read in correctly based on the datatypes. There are 1963 unique brands in the dataset, 25 different departments, and 747 different classes of those items.

Let's take a deeper look into the brands present in the dataset.

```{r}
dt <- data.table(BasketData)
dt <- dt[,sum(Units),by = Brand]
dt <- dt[order(V1)]

par(mfrow = c(1,1))

barplot(tail(dt$V1,20), names.arg = tail(dt$Brand,20), cex.names = 0.7, las = 2, col = 'dark blue', ylab = 'Total Units', main = 'Top-20 Brands' )

barplot(head(dt$V1,20), names.arg = head(dt$Brand,20), cex.names = 0.7, las = 2, col = 'dark blue', ylab = 'Total Units', main = 'Bottom-20 Brands' )


par(mfrow = c(1,1))
```

It looks like we have some brands that are not labeled.  We will want to filter these out of our main dataset before we do any modeling as this will not provide us further insight down the road

Let's look at the blanks to make sure.

```{r}
df_analysis<- BasketData[BasketData$Brand == "",]

dfa_dt <- data.table(df_analysis)
dfa_dt <- dfa_dt[,sum(Units),by = DeptDesc]
dfa_dt <- dfa_dt[order(-V1),]

barplot(head(dfa_dt$V1,20),names.arg = head(dfa_dt$DeptDesc, 20), cex.names = 0.7, las = 2, col = 'dark blue', main = 'Most frequent items with no brand')


```

It looks like stationary is the most "keyed-in" item in the dataset.  There are about 100,000 records for candy and snacks that were keyed in.  While this is not ideal, to filter out candy and snack records, not having this information just introduces incomplete data.  This solidifies the fact that we should probably remove these items. We also have the luxury of having a large number of observations to build our model on.  Therefore the filtering of a couple hundred thousand records is not the end of the world.


### **EDA- Tidy data filtering**

Now that we know that we want to filter out the records with no brand and the records with negative values for individual scans within the transaction, we have to do some interesting filtering.

In order to maintain the integrity of our model, we have to come up with a way to filter the data that allows us to 1.) identify  the transactions that contain negative values 2.) filter out those entire transactions.  

Given that we have such a large dataset, we can afford to filter out entire transactions that contain partial bad records.  While some of these transactions do more than likely contain valid transaction-portions, we cannot be certain.  Therefore, the more conservative approach when thinking about association rule creation is to not risk leaving in partial records that could represent bad data.  We will use the SQLdf package for this portion of the analysis.

```{r}

# let's take out the transactions that contain negative values
# notice that we are taking out distinct transactions and not just those items. 
# this ensures that we get whole itemsets that are not incomplete
BasketData<- sqldf('Select TransactionID, ClassDesc, DeptDesc, Brand, Units
                   From BasketData Where TransactionID Not In  
                   (Select Distinct
                   TransactionID
                   From BasketData
                   Where 
                   Units<=0)')



# ok, that looks like it worked.  Now, we need to see what removal of the transactions without any brand looks like

BasketData<- sqldf('Select TransactionID, ClassDesc, DeptDesc, Brand, Units
                   From BasketData Where TransactionID Not In  
                   (Select Distinct
                   TransactionID
                   From BasketData
                   Where 
                   Brand="")')


```


### **EDA- Learning the Data**

How many transactions contain Redbull?

```{r}

df_analysis_redbull<- BasketData[BasketData$Brand == "RED BULL",]

length(unique(df_analysis_redbull$TransactionID)) # 14046 transactions have redbull
length(unique(BasketData$TransactionID))# 2493458

```
What percentage of transactions is this?

```{r}

length(unique(df_analysis_redbull$TransactionID))/
  length(unique(BasketData$TransactionID)) # looks like about 0.56% of all transactions have a redbull

```

What Class is Red Bull?

```{r}

unique(df_analysis_redbull$ClassDesc)
```

Red Bull is categorized into the Non-carbonated drop ship class. Creation of this class is a legacy of the category management of non-alcoholic beverage primarily by the two major beverage companies - Coke and Pepsi - and their dichotomy of products between their main product lines, Carbonated Soft Drinks, and everything else.  Energy Drinks, when created in the late 90s and early 2000s were considered to be part of the "Everything else" by these companies. 

How many redbulls does the average transaction contain?

```{r}

mean(df_analysis_redbull$Units)

max(df_analysis_redbull$Units)

min(df_analysis_redbull$Units)


```
Looks like about 1.3 units and somebody purchased about 14 units.

What does the distribution of purchased look like? It is probably highly skewed to 1-item purchases.

```{r WARNING = FALSE}

qplot(Units, data = df_analysis_redbull, geom = 'histogram')

```

Just as we thought based on the analysis, mostly one and two can purchases

What is RedBull's candy & snacks transaction share?

```{r}
print('Number of candy and snack transactions:' )
length(unique(BasketData$TransactionID[BasketData$DeptDesc=='CANDY & SNACKS'])) # 1,217,781 with candy or snacks

print('Number of total transactions:' )
length(unique(BasketData$TransactionID)) #2,493,458 total transactions

print('Percent of transactions with candy and snacks: ')
length(unique(BasketData$TransactionID[BasketData$DeptDesc=='CANDY & SNACKS']))/length(unique(BasketData$TransactionID))

print('Percent of candy and snack transactions with RedBull: ')

length(unique(df_analysis_redbull$TransactionID))/length(unique(BasketData$TransactionID[BasketData$DeptDesc=='CANDY & SNACKS']))
# 1.1% of candy or snack transactions contain redbull



```

Alright, it looks like nearly 50% of the transactions in our dataset are in the candy and snacks department, which is the same department as redbull.  

1.1% of all candy and snack transactions contain Red Bull.

I wonder what the biggest competitor looks like?

```{r}
df_analysis_monster<- BasketData[BasketData$Brand == "MONSTER",]

length(unique(df_analysis_monster$TransactionID)) # 25,338 transactions have Monster


```

About 25,338 transactions contain Monster;however, Monster's transaction size may also be associated with their pricing and promotional programming, which commonly calls for two items to be purchased to receive the lower price.  Monster's broader product line, with more flavors and product types - including ready-to-drink Coffee - may also create a "Mix and Match" basket for a shopper.  (This could be another interesting analysis.)

```{r}

print('mean:')
mean(df_analysis_monster$Units)
print('max:')
max(df_analysis_monster$Units)
print('min:')
min(df_analysis_monster$Units)
print('percentage higher than redbull:' )
mean(df_analysis_monster$Units)/mean(df_analysis_redbull$Units)-1

```
Just as suspected, the average transaction amount is a tad higher.  We may want to look at the transaction distribution, despite the fact that it will have a very high positive skew due to all of the 1-item transactions.

```{r}

par(mfrow = c(1,2))

# create the dataframe
rb <- data.frame(rep('RedBull', length(unique(df_analysis_redbull$TransactionID))))
df1<- cbind(rb, data.frame(df_analysis_redbull$Units))
colnames(df1) = c('brand','units')

mon <- data.frame(rep('Monster', length(unique(df_analysis_monster$TransactionID))))
df2<- cbind(mon, data.frame(df_analysis_monster$Units))
colnames(df2) = c('brand','units')


df3<- rbind(df1,df2)

boxplot(units~brand, data = df3)

# looks like 42 from Monster skews things a bit, let's filter it

df3<- df3[df3$units<30,]

boxplot(units~brand, data = df3)

par(mfrow = c(1,1))


```
Ok, it doesnt look like their distributions are really that much different.  Both have a high degree of positive skew.

We would like to look at Redbull on a transaction level next.  This will help us better understand the rules that we get out of our model.

How many items are purchased in each Redbull transaction?

```{r}
# How many items are purchased in each redbull transaction?

redbull_items_purchased<-sqldf('select avg(brands) As num_brands, avg(total_units) As avg_units From
                               (select TransactionID,count(Distinct(Brand)) As brands,
                               Sum(Units) AS total_units  From BasketData Where 
                               TransactionID in (select distinct TransactionID From BasketData Where Brand = "RED BULL") Group By 1)' )

print(redbull_items_purchased)

```
On average, there are about 5.3 units in each transaction.  We also see that there are fewer brands.  Therefore, this means that something is getting purchased multiple times in the transaction. Let's hope it is RB.

Are most transactions Redbull by itself?

```{r}

redbull_plus_snack_df<-sqldf('select TransactionID, ClassDesc, DeptDesc, Brand, Units  From BasketData Where 
                             TransactionID in (select distinct TransactionID From BasketData Where Brand = "RED BULL")
                             And Brand<> "RED BULL"')

length(unique(redbull_plus_snack_df$TransactionID)) 

```
Alright, the vast majority of Redbull transactions contain alot more than one item.

Ok, which brands are most often purchased with RB?

```{r}
brand_df<- sqldf('Select Brand, Count(*) As trans, Sum(Units) As units_purch  From redbull_plus_snack_df Group By 1 Order By 3')


barplot(tail(brand_df$units_purch,20), names.arg = tail(brand_df$Brand,20), cex.names = 0.7, las = 2, col = 'dark blue' )

```

It looks like we have some store brands, and unbranded category.  Unbranded items are actually really common for this retailer - occurring most often in Home Decor, Stationery, Sundries, and Shoes for Departments.

Wow!  Monster is the next most purchased, followed by Mountain Dew. It is really interesting.  Lots of beverage and energy products are purchased together and junk food also appears to be very popular.

That's nice, but which department are these items in?

```{r}
department_df<- sqldf('Select DeptDesc, Count(*) As trans, Sum(Units) As units_purch  From redbull_plus_snack_df Group By 1 Order By 3')

barplot(tail(department_df$units_purch,20), names.arg = tail(department_df$DeptDesc,20), cex.names = 0.7, las = 2, col = 'dark blue' )
```
Just as we saw earlier, candy and snacks dominate.


Which classes do these encompass?

```{r}

class_df<- sqldf('Select ClassDesc, Count(*) As trans, Sum(Units) As units_purch  From redbull_plus_snack_df Group By 1 Order By 3')

barplot(tail(class_df$units_purch,20), names.arg = tail(class_df$ClassDesc,20), cex.names = 0.7, las = 2 , col ='dark blue')
```

So the non-carbonated looks high.  However, now we see that cigarettes are pretty popular compliments to the Redbull.


I wonder which candy and snacks are most popular with RedBull?

```{r}

candy_snack_df<- sqldf('Select Brand, Count(*) As trans, Sum(Units) As units_purch  
                       From redbull_plus_snack_df Where DeptDesc ="CANDY & SNACKS" Group By 1 Order By 3')

barplot(tail(candy_snack_df$units_purch,20), names.arg = tail(candy_snack_df$Brand,20), cex.names = 0.7, las = 2 , col = 'dark blue')

```
All soft drinks and doritos. We can see that it might be appealing to have a little sweet and savory.  However, it looks like sweets are also a favorite, with little debbies and Hersheys being up next.


Something we have to jump into now is the idea of different combinations of transactions.  We should probably group the dataset by the number of items in each transaction.  This will help us better interpret the rules that we get out of the model as interesting or not.  It also may help us set our values for minsup, etc.

```{r}

# add dimension to the dataset

redbull_brands_in_trans<-sqldf('select T1.TransactionID As TransactionID ,brands, ClassDesc, DeptDesc, Brand, Units  
                               From BasketData As T1
                               Inner Join ( Select TransactionID, Count(Distinct(Brand)) As brands From BasketData Group By 1) As T2
                               On T1.TransactionID = T2.TransactionID
                               Where T1.TransactionID in (select distinct TransactionID From BasketData Where Brand = "RED BULL")')


```

**Transactions with 2 brands**

```{r}
# 2 brand transactions (filter out RB)

two_brand_trans<- sqldf('select brand, sum(Units) As units From redbull_brands_in_trans
                        Where
                        Brand <> "RED BULL"
                        And brands = 2
                        Group By 1
                        Order By 2
                        
                        ')

barplot(tail(two_brand_trans$units,20), names.arg = tail(two_brand_trans$Brand,20), cex.names = 0.7, las = 2, col = 'dark blue' )


```
So, a few things start to shake out here.  We see that in 2 brand transactions Marlboros are very popular.  This is of course followed by Monster.  

**Transactions with 3 brands**

```{r}
# 3 brand transactions (filter out RB)

three_brand_trans<- sqldf('select brand, sum(Units) As units From redbull_brands_in_trans
                          Where
                          Brand <> "RED BULL"
                          And brands = 3
                          Group By 1
                          Order By 2
                          
                          ')

barplot(tail(three_brand_trans$units,20), names.arg = tail(three_brand_trans$Brand,20), cex.names = 0.7, las = 2, col ='dark blue'
        )

```
As we start adding more items, store brands start to become a larger proportion.  This is probably a customer who comes in for one thing and picks up some smokes and an energy boost while they are at it.


**Transactions with 4 brands**

```{r}
four_brand_trans<- sqldf('select brand, sum(Units) As units From redbull_brands_in_trans
                         Where
                         Brand <> "RED BULL"
                         And brands = 4
                         Group By 1
                         Order By 2
                         
                         ')

barplot(tail(four_brand_trans$units,20), names.arg = tail(four_brand_trans$Brand,20), cex.names = 0.7, las = 2, col = 'dark blue' )


```
So, it looks like folks who come in for more than 3 distinct items still like to purchase other energy drinks, but cigarettes occur in fewer transactions.  Store brands also become much more popular.

**Transactions with 5 brands**

```{r}
five_brand_trans<- sqldf('select brand, sum(Units) As units From redbull_brands_in_trans
                         Where
                         Brand <> "RED BULL"
                         And brands = 5
                         Group By 1
                         Order By 2
                         
                         ')

barplot(tail(five_brand_trans$units,20), names.arg = tail(five_brand_trans$Brand,20), cex.names = 0.7, las = 2, col= 'dark blue' )

```

It looks like home products really jump up with 5 items.  We definitely see alot of consistency in the top 10 brands that are all purchased together though.

That being said, we would like a better way of associating these products together than simple visual analytics.  It would be really nice to be able to look at significant rules and baskets that occur very frequently as it is obviously very cumbersome to do with nearly 2000 brands.

### **Association Rules**

####**Overview**

For the first sets of rules, we will really trim down the dataset substantially. We will only look at transactions that contained redbull as we are most interested in the rules associated with those transactions.  We will then show transactional rules for product classes and all products in the entire dataset.  By creating rules for the entire set, we can see if there are any interesting baskets of data that Redbull should want to be a part of in the future.

####Redbull Transactions- Brand Level Rules

We will use a filtered dataframe to produce rules around just the purchases that include RedBull

```{r}


redbull_arules<-sqldf('select TransactionID, ClassDesc, DeptDesc, Brand, Units  From BasketData Where 
                             TransactionID in (select distinct TransactionID From BasketData Where Brand = "RED BULL")
                             ')



```

```{r}
head(redbull_arules)


```

This is nice, but I am going to need to pair this particular dataset down a bit.  It might make sense to look at just the baskets for the departments that are most common in RedBull transactions.  Let's see what those are

```{r}

most_common_depts = sqldf('select deptdesc, count(*) As occurances From redbull_arules Where Brand <> "RED BULL" Group By 1 Order By 2 desc')



```

```{r}

head(most_common_depts)

```

Most of the items that are purchases with redbull are candy and snacks, food, and perishables.  For our rules, let's just take a subset of the transactions that include these items in them to see if we can find anything that is of interest.

```{r}

redbull_arules <- sqldf('Select * From redbull_arules Where DeptDesc In ("CANDY & SNACKS","FOOD","PERISHABLES")')


```


```{r}
print(summary(redbull_arules))

#print(nrow(redbull_arules))


```


Ok, so we have substantially decreased the size of the original dataset.  However, we have really narrowed down the problem.  Let's see what we get.


```{r}

length(unique(redbull_arules$Brand))


```


We have 558 brands in this dataset.  While it would be nice to evaluate all of them, it probably makes sense to eliminate the ones that do not occur that frequently.  While, from a filtering perspective, we will only be creating partial transactions in this case, we will be looking at the transactions that have commonality with redbull in order to make the rules.  Therefore, this approach still has some validity and may produce and some interesting rules.

```{r}
most_pop_brands <- sqldf('Select Brand, count(*) As occurances  From redbull_arules Where Brand <> "RED BULL" group by 1 Order By 2')


barplot(tail(most_pop_brands$occurances,30), names.arg = tail(most_pop_brands$Brand,30), cex.names = 0.7, las = 2 , col = 'dark blue')


```

These look like really good brands that we might want to make some rules for with Redbull purchases...Now, we have to format the data appropriately

First, filter for just these brands:

```{r}

redbull_arules<- sqldf('Select * From redbull_arules Where Brand In (Select Brand From (Select Brand, count(*) As occurances  From redbull_arules group by 1) base
                     Where occurances >=156)')

```

```{r}

length(unique(redbull_arules$Brand))

```

Now, we have isolated those top 30 brands that occur with Red Bull most often


```{r}

keepers<- c('TransactionID','Brand')

redbull_arules <- redbull_arules[keepers]


redbull_arules$present <- 1

#redbull_arules_wide<- spread(redbull_arules, Brand, Present)

summary(redbull_arules)

redbull_arules<- sqldf('Select Distinct * From redbull_arules') # need to pull in only unique values for our transactions

redbull_arules_wide<- spread(redbull_arules, Brand, present)


```


This is now the new dataframe that we will plug into our Apriori algorithm.  Let's just make sure everything makes sense

```{r}
print( nrow(redbull_arules_wide))

```
```{r}

print( ncol(redbull_arules_wide))

```

We have narrowed this set down to 14,046 transactions and 32 columns (30 brands + redbull + transaction id = 32)

```{r}

summary(redbull_arules_wide)

head(redbull_arules_wide)

str(redbull_arules_wide)

# need to binarize the dataset

redbull_arules_wide<-as.data.frame(colwise(as.logical)(redbull_arules_wide))

redbull_arules_wide_2<- as.data.frame(redbull_arules_wide[,-1]) # remove transaction ID

trans<-as(redbull_arules_wide_2, "transactions") # use this to contain redbull

redbull_arules_wide_3<- as.data.frame(redbull_arules_wide_2[,-which(colnames(redbull_arules_wide_2)=='RED BULL')]) # remove transaction ID and redbull

trans_2 <- as(redbull_arules_wide_3, "transactions") # use this for analysis without redbull



```

Let's try building out rules


```{r}

#which(colnames(redbull_arules_wide_2)=='RED BULL')

#head(redbull_arules_wide_2)

itemFrequencyPlot(trans_2)


```

So, it looks like we have decent supports among all of the redbull transactions for the variables.  Obviously, the store brand is the highest support just because of the amount of products that this brand offers in the categories that we selected for this analysis.

Just as we saw in our previous graphical breakdowns, Monster has very high support as well as mountain dew and coke.  

```{r}

# these are all of the frequent itemsets purchases with redbull, redbull is not needed in the transaction information, because the transactions are all pre-filtered for Red Bull

itemsets<-apriori(trans_2, parameter = list(target="frequent", supp=0.001, minlen=1))

inspect(head(sort(itemsets), n=20))


```

Let's look at the quality of the rules that have been created by showing lift as well

```{r}
quality(itemsets)$lift <- interestMeasure(itemsets, measure="lift", trans = trans_2)
inspect(head(sort(itemsets, by="lift"), n=20))

```

These rules are interesting. So, when we try to predict these rules occuring in the itemsets, these are the ones where our confidence is within expectation.  Remember that lift = confidence/expected confidence.  

Notice that the lift shows that the important transactions start to move away from the 2-item transactions and really focus in on some of the very interesting-niche cases.  For instance, the first rule with a lift of 44 shows somebody purchasing Kraft products, Betty crocker, and clover valley occur very frequently in redbull transactions.  We may be able to surmise that this is somebody who is going to the store to pick up a few items to cook dinner or to stock up for the week.  They just so happen to pick up a red bull when they do this, and they do it more often than we would expect.  
The second rule is interesting as well.  This look like folks who drop in, to pick up their breakfast for the week, but they also buy a redbull when they buy these items.  Let's hope that they are not putting the redbull and milk on their cereal.  

In general, many of the remaining rules appear to show that folks really like junk food with their energy drinks.  They also tend to purchase multiple beverages together when they do this.  



```{r}

plot(head(sort(itemsets, by="lift"),10),
  method="graph", control=list(cex=.7))


```

```{r}

plot(head(sort(itemsets, by="support"),20),
  method="graph", control=list(cex=.7))


```


Let's change the target a bit here to see if we notice any new rules coming out of the dataset


```{r}
itemsets_2 <- apriori(trans_2,parameter = list(minlen=1, supp=0.01, conf=0.01))

itemsets_2_sorted <- sort(itemsets_2, by="support")
inspect(itemsets_2_sorted)

```

These are the same rules that we had previously seen However, now, with the new paramters we return just 34 rules that we are interested in.  Most of the rules are still 2 item rules (everything with no item in antecedent(lhs) on the left is redbull + the consequence (rhs) item)





```{r}

itemsets_2_sorted = head(sort(itemsets_2, by="lift"),6)

plot(itemsets_2_sorted, by="lift",
  method="grouped", measure = 'confidence', shading = 'lift')

#inspect(itemsets_2_sorted)

itemsets_2_sorted = sort(itemsets_2, by="lift")


inspect(itemsets_2_sorted)

```



It looks like the most interesting rule occurs when little debbies and 5-hour energy drinks are purchased with Red Bull.  This is a fascinating combo!  I am sure your pancrease, liver, and heart love you when you take this cocktail togther.

From a business perspective, I wonder if we could somehow partner with 5-hour and little debbie to make "Energy Fuel Kits" or something.  Take a shot of energy now, then get a nice stream of energy throughout time from the Red Bull and amp up with Little Debbie for that afternoon boost!

The interesting thing about these rules is that we would not necessarily have picked up on these relationships had we not used the Arules package to derive these itemsets.  Although our dataset was a bit contrived, it is interesting to see the results that we got back from the models.


**Cross Category Transactions**

While there are a high number of transactions that occur just within the "Candy and Snack" department, it is important to understand the role that our products play in transactions occurring in the total store.  From a strategic standpoint, our ability to influence decision makers is reinforced when our transactions involving our product involve products from multiple departments.

Obviously for the retailer, the larger the basket, the bigger value and profit delivered.  Therefore, we will mine records from all categories in the store.  Red Bull, as the target product, will be maintained at the Brand level, while the rest of the Candy/Snacks/Beverage Department it belongs to will be presented at the Category level, while the remainder of the store will be referenced at the Category level.  An explanation of the products contained in each remaining grouping is included in the appendix.

```{r}
#This entire section of code will reshape the data for the arules requiremments
#Filter negative Unit Transactions
#remove any transaction where some part of it is negative

BasketData<-read.csv("Data/BasketData.csv")
colnames(BasketData)<-c("TransactionID", "ClassDesc", "DeptDesc", "Brand", "Units")
#Fix data that came with commas
BasketData$Units<-as.numeric(gsub(",", "", as.character(BasketData$Units)))

#Fix TransactionID to be non negative
BasketData$TransactionID<-abs(BasketData$TransactionID)


Negative<-unique(filter(BasketData, Units<0)) %>% group_by(TransactionID) %>% summarise()

BasketData<-filter(BasketData, !TransactionID %in% Negative)

length(filter(BasketData, Units<0))

#Reshape Data
#We want Red Bull at the Brand Level
RedBull<-filter(BasketData, Brand=="RED BULL")
RedBull$Desc<-"RedBull"

#Subtract it from rest of data set, so when we consolidate to class/dept level for remainder it isn't double counted
BasketData2<-filter(BasketData, Brand!="RED BULL" & DeptDesc!="CANDY & SNACKS")
BasketData2$Desc<-paste(BasketData2$DeptDesc)

#We want rest of Candy and Snacks at ClassDesc Level
BasketData3<-filter(BasketData, Brand!="RED BULL" & DeptDesc=="CANDY & SNACKS")
BasketData3$Desc<-paste(BasketData3$ClassDesc)


#Make 3 tables - one for the RB items, rest of Beverage/Snack, and everything else in store
BasketSummary<-group_by(BasketData2, TransactionID, Desc) %>% dplyr::summarise(Present=1)


BasketSummary2<-group_by(RedBull, TransactionID, Desc) %>% summarise(Present=1)
BasketSummary3<-group_by(BasketData3, TransactionID, Desc) %>% summarise(Present=1)


#Vertical combination
BasketSummary<-rbind(BasketSummary, BasketSummary2, BasketSummary3)

rm("BasketSummary2", "BasketSummary3", "BasketData2", "BasketData3")

#length(unique(BasketSummary$Desc))
#Overall Basket most frequent product Desc
#print(group_by(BasketSummary, Desc) %>% summarise(Count=length(unique(TransactionID))) %>% arrange(-Count))

#write our progress out to a CSV file
write.csv(BasketSummary, "BasketSummary.csv")

#This moves the data from being a long data table to being a wide sparse matrix as required for the 
#arules library to work
SummaryWide<-read.transactions("BasketSummary.csv", format="single", sep=",", cols=c("TransactionID", "Desc"))
```


```{r}
summary(SummaryWide)
```

The summary function for a transaction object produces a somewhat useful summary of what the transaction looks like.  Most notable is the transaction count by number of items (in the case of our data, categories) in the basket.  Inspection finds more than 1 million single item baskets, with a significant drop in support (n) for any transaction with more than 5 items.  We can use this information to influence our decision point on the "length" parameter in our analysis.

```{r fig.width=8.5, fig.height=4}
itemFrequencyPlot(SummaryWide, topN=15)
```

Food, Healthcare, Home Cleaning, Paper Products seem to be most frequent Items in Basket.  As a retailer, these would be considered "Trip Drivers" that might be expected to have a lower margin but very high volume.  As a retailer strategy, shoppers might be drawn to the store for these high-frequency, high volume products, and then add several higher priced, higher margin items to their cart.  The Trip Drivers typically have lower margins, as the retailer uses these products to compete with other retailers on price.

As a manufacturer of a lower penetration item, we want to focus on what is sold alongside our product in the larger context of the store, and how it affects the retailer's overall store performance.


```{r}
RBBaskets<-subset(SummaryWide, items %in% "RedBull")
RBFreq<-as.data.frame(itemFrequency(RBBaskets))
RBFreq$Item<-row.names(RBFreq)

RBFreq$Frequency<-comma(RBFreq$`itemFrequency(RBBaskets)`)
RBFreq<-arrange(RBFreq, desc(Frequency))
RBFreq
```

24% of Baskets with Red Bull also contained FOOD.
18% of Baskets with Red Bull also contained PERISHABLES.
17.6% of Baskets with Red Bull also had Dropship Carbonated Soft Drinks.
16% of Baskets with Red Bull also had Health Care.
13% of Baskets with Red Bull also had Home Cleaning.

While these co-occurrences are interesting, our earlier frequency display showed us that the Food is in more than 20% of baskets overall, perishables were in more than 15% of baskets, and Home Cleaning, and Health Care were also high penetration items.  The association rules will help define what's novel and has significance in the basket set. 

First we will examine some of the common association rules from the overall store, before focusing on just the transactions containing Red Bull.  The view of all association rules might help us understand what draws shoppers to the retailer overall and categories that the retailer may view as "Must Win" when considering their share of market versus the competition.

Minimum Support was specified as 0.00002, which with our nearly 3 million transactions will provide us a required occurrence of 59 transactions for inclusion.  The minimum support was arrived through inspection of transactions with Red Bull - which occur at a much lower level oveall(<0.5% of all transactions), to attempt to locate some useful information about shopper behavior. We have also specified a maximum length of 5, since as noted above the significant fall-off in transaction count above 5 categories in the transaction.  

```{r fig.height=8, fig.width=8}
#mine associations
#itemsets<-apriori(SummaryWide, parameter = list(target="frequent", supp=0.001, minlen=1))
#inspect(head(sort(itemsets), n=50))


#quality(itemsets)$lift <- interestMeasure(itemsets, measure="lift", trans = SummaryWide)
#inspect(head(sort(itemsets, by="lift"), n=50))


#plot(head(sort(itemsets, by = "lift"), n=50), method = "graph", control=list(cex=.8))

r <- apriori(SummaryWide, parameter = list(supp=0.00002, maxlen=5))
inspect(head(sort(r, by="lift"), n=50))
#plot(r)

```

Among the association rules with the greatest lift, two categories appear to be the most frequent dependent item: Stationery and Health Care.  

Given that our data is from the end of January, the highest lift basket contains Domestics, Holiday Events, Special Events, and Valentine's Candy, and predicts that basket, with 81% confidence will also contain Stationery.  This makes perfect sense - considering this could be a greeting card or include the Valentines that children would exchange at school.  In a similar transaction, the shopper has Domestics, Holiday Events, Home Decor, and Toys in their basket and also buys Stationery.

Beauty Care is also a frequent occurrence as the dependent side of the basket.  The items on the left hand side suggest it could be a Mother shopping for household items, and for a small child in the house - with items like Infant/Toddler/Girls Clothing (or Diapers), Ladies Clothing, Housewares, and Health Care frequently a part of the basket.

The Perishables category is shown as the dependent side of the basket for several basket configuration heavy with Food and Snack items - including Sweet Goods, the full Food department, Crackers and Carbonated Beverages.

While somewhat anecdotal, it appears there are fewer high lift transactions found that mix baskets significant between Food items (including Candy, Snacks, Beverage, and Perishables) and Home Goods, Apparel, Home Cleaning and Health and Beauty.

Now we can move on to look at the cross-category Baskets that specifically include Red Bull, by first subsetting baskets to force inclusion of Red Bull.
```{r}
#This is a subset of the rules to just show Red Bull related
r_RB<-subset(r, subset=items %in% "RedBull")

#r_RB<-subset(itemsets, subset=items %in% "RedBull")

#itemFrequency(items(r_RB))

itemFrequencyPlot(items(r_RB), topN=20)
```

Among baskets including Red Bull, all of the baskets with at least two categories also include Food and Perishables.  This is a really interesting finding, and goes to define the mission our shopper may be on - they are buying some type of food (shelf stable), as well as a fresh perishable category item - which might include Milk, Bread, or Beer.  

Beyond these two categories, frequency drops substantially.  While Paper Products are the 4th highest penetration category at the retailer, they are not present as frequently as food or perishables are in Red Bull baskets.

Prior to reviewing the association rules, we might hypothesize that the basket includes Food, Perishables, and potentially one of the snack categories when Red Bull is purchased.

```{r}
inspect((sort(r_RB, by="lift")))


#plot(head(sort(r_RB, by="lift"), 20), method="graph", control=list(cex=.7))

```

Our support aligns with our minimum possible transactional support, about 59 out of the total set of transactions.  Confidence for all of the rules created is above 80%.

The highest lift association rules suggest that Perishables, Red Bull, and another item will lead to a purchase of an item from the Food Category.

As documented in the first section, the relationships with snack food is well established.  The third association rule might suggest a single serve snack or candy, an item from perishables like Bread or Milk, along with Red Bull leads to a purchase of Food.

It looks like if we rearranged the categories a tad and potentially added some additional details in the food area, our insights might be better from this dataset.  Additionally, if we extract some of the different food categories into groupings, we might find some better/more actionable rules.  

###Investigating Geolocation Connections of Baskets
While there was only a single physical store configuration included in the data set - Traditional - and the time of the analysis limited to a single week - there is still many factors that could cause additional variation in the basket composition.  Any store-level differences, or differences in the shopper demographics, could be reflected in their preferences while shopping.

```{r}
#Bring in the transaction to store translation
TransStore<-read.csv("Data/TransByStore.txt")
colnames(TransStore)<-c("TransactionID", "Date", "Time", "Store", "StoreDiv", "State", "Latitude", "Longitude", 
                        "SqFt", "Sales", "Units")
TransStore$TransactionID<- -(TransStore$TransactionID)

#Subset out the Red Bull Transactions
RBTrans<-filter(BasketSummary, Desc=="RedBull")

RBTrans2<-filter(BasketSummary, TransactionID %in% RBTrans$TransactionID)

RBWide<-spread(RBTrans2, Desc, Present, fill = FALSE)

#Rule A: Crackers, Paper Products, Perishables, RedBull ->FOOD
RuleATrans<-filter(RBWide, CRACKERS==1 & `PAPER PRODUCTS`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleATrans$Rule<-"A"

#Rule B: Crackers PRIVATE BRAND, Perishables, RedBull ->FOOD
RuleBTrans<-filter(RBWide, `CRACKERS PRIVATE BRAND` ==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleBTrans$Rule<-"B"


#Rule C: Candy/Snack/Bev $1, Perishables, RedBull ->FOOD
RuleCTrans<-filter(RBWide, `CANDY/SNACK/BEV $1` ==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleCTrans$Rule<-"C"


#Rule D: Chocolate Candy, Paper Products, Perishables, RedBull ->FOOD
RuleDTrans<-filter(RBWide, `CHOCOLATE CANDY`==1 & `PAPER PRODUCTS`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleDTrans$Rule<-"D"


#Rule E: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleETrans<-filter(RBWide, `SALTY SNACKS`==1 & `PAPER PRODUCTS`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleETrans$Rule<-"E"


#Rule F: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleFTrans<-filter(RBWide, COOKIES==1 & `HEALTH CARE`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleFTrans$Rule<-"F"

#Rule G: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleGTrans<-filter(RBWide, COOKIES==1 & `SALTY SNACKS`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleGTrans$Rule<-"G"

#Rule H: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleHTrans<-filter(RBWide, `SALTY SNACKS`==1 & `BEAUTY CARE`==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleHTrans$Rule<-"H"

#Rule I: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleITrans<-filter(RBWide, `CARBONATED DRINK-DROPSHIP`==1 & CRACKERS==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleITrans$Rule<-"I"


#Rule J: PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull ->FOOD
RuleJTrans<-filter(RBWide, `SALTY SNACKS-DROPSHIP`==1 & CRACKERS==1 & PERISHABLES==1 & RedBull==1 & FOOD==1)
RuleJTrans$Rule<-"J"

#Vertically Bind Rules A-J
TargetTrans<-rbind(RuleATrans, RuleBTrans, RuleCTrans, RuleDTrans, RuleETrans, RuleFTrans, RuleGTrans,
                   RuleHTrans, RuleITrans, RuleJTrans)

#remove the contents of transactions but keep the rule name and the transaction id
TargetTrans<-TargetTrans[c(1,53)]
#length(unique(TargetTrans$TransactionID))

#match TransactionID back to attributes of the transaction
TransWithAttribute<-inner_join(TargetTrans, TransStore, by="TransactionID")

#Fix the date field to be a date
TransWithAttribute$Date<-as.Date(TransWithAttribute$Date, "%m/%d/%y")

TransWithAttribute$DayOfWeek<-weekdays(TransWithAttribute$Date)

group_by(TransWithAttribute, Rule) %>% summarise(StoreCount=length(unique(Store)), TransCount=length(unique(TransactionID)), TransPerStore=TransCount/StoreCount) %>% arrange(-TransPerStore)

```

We've assigned each of the top 10 transactions based on lift to a letter - with A being the highest lift rule - and then matched the attributes of the transaction to see if some of the metadata of the transaction helps understand if there's additional patterns to the transactions.  Rule J, for example, (Association Rule: {PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull} ->FOOD) occurred in 74 different stores, covering 78 different transactions.  

Rule E had the most frequent occurrence per store, at 1.13 per store (at least within the set of stores where the transaction actually occurred).  
```{r}
group_by(TransWithAttribute, Store) %>% summarise(RuleCount=length(unique(Rule)), TransCount=length(unique(TransactionID)), TransPerRule=TransCount/RuleCount) %>% arrange(-TransCount)


```
While it appears that each trasnsaction rule didn't occur at any one store many times, there were stores that had several different transaction rules happen (althought there may have been 1 transaction that could satisfy several of the rules, given our constraints of maximum rule length, confidence and support). Store 7962 did see 9 of the 10 different rules applied in 8 unique transactions.  

We can attempt to use K Means Clustering to see if there's any grouping that might be made based on the occurrence of different rule sets within a store.  We've aribitrarily elected to start with a value of 3 clusters, which might yield a low/medium/high grouping for 

```{r}
set.seed(4636)
TransWithAttribute$Present<-1


ClusteringMatrix<-group_by(TransWithAttribute, Store, Rule) %>% summarise(Transactions=sum(Present)) %>% spread(Rule, Transactions, fill=0)
ClusteringMatrix$TotalTrans<-rowSums(ClusteringMatrix[c(2:11)])

ClusterStoreOnTrans<-kmeans(as.matrix(ClusteringMatrix[2:11]), 3)

ClusteringMatrix$cluster<-ClusterStoreOnTrans$cluster
print(ClusteringMatrix)
```

It appears that the clustering has placed nearly all stores that satisfied Rule D ({Chocolate Candy, Paper Products, Perishables, RedBull}->FOOD) into the cluster "1".  It might be hypothesized that these stores could take advantage of an occasion-based display within the store that suggests items from these categories together.  

Meanwhile, Stores that mostly satisfy Rule C ({Candy/Snack/Bev $1, Perishables, RedBull} ->FOOD) were aggregated to Cluster 3. The contents of this basket might suggest a "Snack" occasion for most of the items, perhaps paired with a purchase of something for a meal to be constructed later.  The perishable could represent Beer or Wine as well.

The remaining cluster, shown as 2 in the table, seems to be stores that had no transactions to satisfy either transaction Rule C nor Rule D, and the rules satisfied seem to be more randomly distributed.


```{r fig.width=8.5, fig.height=8}
#rule by day of the week
TransWithAttribute$DayOfWeek<-weekdays(TransWithAttribute$Date)
TransWithAttribute$DayOfWeek<-as.factor(TransWithAttribute$DayOfWeek)
levels(TransWithAttribute$DayOfWeek)
TransWithAttribute$DayOfWeek<-factor(TransWithAttribute$DayOfWeek, levels(TransWithAttribute$DayOfWeek)[c(2, 6, 7, 5, 1,3, 4)])
                                     
#                                     ("Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
#                                                                               "Saturday", "Sunday"))

ggplot(TransWithAttribute, aes(x=DayOfWeek))+geom_bar()+facet_wrap(~Rule) + theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

Rule H ({PAPER PRODUCTS, PERISHABLES, SALTY SNACKS, RedBull}->FOOD) has an interesting pattern, with a frequency on Saturday of more than 2x the occurences then any other day of the week.  An observer might guess this pattern corresponds to a "Party" occasion, especially given the proximity of the range of dates to the Super Bowl - that shoppers were stocking up on Paper Products (including paper plates and napkins), Perishables (which includes the Beer category), Salty Snacks, and Red Bull, which predicted that some item from the Food Category would also be in the basket. 

###Summary and Conclusions
The rules uncovered in this analysis seem to follow some of the researchers prior understanding of shopping patterns in the retailer, as well as for the Red Bull brand overall.  However, specific to the retailer and the dates researched, several additional baskets were uncovered.

Knowledge gained from this research will be discussed with the retailer based on a broader research piece following a similar format.

###Next Steps
While this analysis addressed a specific store format over a limited run of time, the other 75% of stores in the chain will need to be researched and analyzed in similar fashion.  The structure of this report introduces a good framework that can used for additional insight into other store formats.  

While the level of detail presented in this document has proved useful, there are additional insights that might be found through revision of the "Description" field to focus additional attention on some high frequency categories, and less detail to some of the subcategories of the Candy, Snack and Beverage category through consolidation.  Within the Red Bull brand, differences of purchases of Multipacks and Single serve may also be useful.

Another product of this analysis could lead to segmentation of customers, based on the trip profiles.  If the retailer has the ability to tie together multiple transactions of a customer across days, locations and understand shopping missions for the same shopper.  


###Appendix: Description of Item Categories in Full Data Set
ACCESSORIES: Includes hats, jewelry, outerwear, and other miscellaneous clothing items.
BEAUTY CARE: Soap, Shampoo, Lotions, and fragrances.
DOMESTICS: Home furnishings including bedding, floor coverings, and home accessories.
FOOD: Outside of Candy and Snacks, FOOD is the most frequently observed basket item.  The department includes canned, frozen, and all other shelf-stable food except for snack foods.
HARDWARE: Motor oil, auto accessories, and tools.
HEALTH CARE: All over the counter medication, dental care, and nutritional supplements.
HOLIDAY EVENTS: Seasonal non-food items, including home furnishings and costumes.
HOME CLEANING: All home cleaning products, including dish care, floor care, laundry care, and insecticides.
HOME DECOR: Decorative items, including baskets, clocks, and candles.
HOUSEWARE: Cookware, mops, brooms, and kitchen gadgets.
INF/TODDLERS/GIRLS: Diapers, Wipes, Baby to Toddler Clothing (both genders) and girls' clothing.
LADIES: All women's clothing.
MENS/BOYS: All Men and Boys' clothing.
PAPER PRODUCTS: Paper towels, toilet paper, paper plates, cups, and bowls, aluminum foil, plastic bags, and garbage bags.
PERISHABLES: Fresh food including bread, milk, cheese, and eggs, ice, as well as Beer and Wine.
PET: All dog and cat food, treats, accessories and cat litter.
SHOES: All footwear for all ages and genders.
SLEEPWEAR/INTIMATES/SOCKS: Socks, undergarments, and pajamas.
STATIONERY: Greeting cards, school supplies, periodicals, books, and fireworks.
SUMMER/SPECIAL EVENTS: Outdoor furniture, fans, beach goods, grills.
SUNDRIES: Batteries, gift cards, DVDs, video games, and other small electronics.
TOBACCO: Cigarettes and smokeless tobacco, as well as electronic cigarettes.
TOYS: All toys.

Items from the Candy & Snacks department have been maintained at the Category Level:
CARBONATED DRINKS - DROPSHIP: Carbonated beverages (Soda or Pop, depending on your region of the country) that are delivered directly to the store.  This would encompass most major brands, like Coke and Pepsi.
SALTY SNACKS - DROPSHIP: This would include chips and pretzels that are delivered directly to the store, from brands like Frito-Lay.
CHOCOLATE CANDY: Non-seasonal chocolate candy.
SALTY SNACKS: Salty snacks, but from brands serviced through the retailer's warehouse.
NON-CHOCOLATE CANDY: Non-chocolate candy.
SINGLE SERVE: Single serve candy.  This would primarily be the packages sold near a checkout as an impulse purchase.
NON-CARBONATED DROP SHIP: Teas, Ready-to-Drink Coffee, and Energy drinks from major brands delivered directly to the store. While Red Bull is normally part of this category, it is being excluded for purposes of examining more closely.
GUM/MINTS: Gum and Mints.
COOKIES: Cookies managed through the retailer's warehouse.
CRACKERS: Crackers managed through the retailer's warehouse.
SWEET GOODS-DROPSHIP: Doughnuts, cakes and pastries delivered direct to the store.
WATER: Water managed through the retailer's warehouse.
DSD WATER: Water delivered diretly to the store.
COOKIES PRIVATE BRAND: Store brand ("Private Label" or "White Label") Cookies.
NUTS: All types of peanuts and tree nuts.
NON CHOC CANDY PRIV BRAND: All types of candy with store or private label.
CARBONATED BEVERAGES: Retailer warehouse managed carbonated soft drinks (Pop, Soda, or CSD)
CANDY/SNACK/BEV $1: Items from these categories priced at $1.
SALTY SNACK REGIONAL DS: Direct shipped to store salty snacks from non-national brands.
CHRISTMAS CANDY: Seasonal (Christmas) Candy.
DRINK MIX: Powdered and concentrated liquid drink mixes.
CRACKERS PRIVATE BRAND: Store brand crackers.
HALLOWEEN CANDY: Seasonal (Halloween) candy.
NON-CARBONATED WHSE: Beverages including tea, ready-to-drink coffee, and energy drinks managed through the retailer's warehouse.
EASTER CANDY: Seasonal (Easter) candy.
HISPANIC: Snack items oriented towards the Hispanic consumer.
VALENTINES CANDY: Seasonal (Valentine's Day) Candy.
8/$1 and 4/$1: Items eligible for bundled price deal.
